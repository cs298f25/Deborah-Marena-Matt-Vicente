openapi: 3.0.0
info:
  title: Student Management API
  description: "API for managing student resources including listing, uploading, and template download."
  version: 1.0.0
servers:
- url: /
paths:
  /api/students:
    get:
      summary: Retrieve paginated list of students
      operationId: getStudents
      parameters:
      - name: page
        in: query
        description: Page number for pagination (default 1)
        required: false
        schema:
          type: integer
          default: 1
      - name: page_size
        in: query
        description: Number of students per page (default 20)
        required: false
        schema:
          type: integer
          default: 20
      - name: search
        in: query
        description: "Case-insensitive search on first name, last name, or email"
        required: false
        schema:
          type: string
      responses:
        "200":
          description: Paginated list of students
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/inline_response_200"
  /api/students/upload:
    post:
      summary: Upload a CSV file to insert or update students
      operationId: uploadStudentsCsv
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/students_upload_body"
        required: true
      responses:
        "200":
          description: Summary of CSV upload results
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/inline_response_200_1"
        "400":
          description: Bad input error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/inline_response_400"
        "500":
          description: Unexpected server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/inline_response_400"
  /api/students/template:
    get:
      summary: Download CSV template for student upload
      operationId: downloadStudentTemplate
      responses:
        "200":
          description: CSV template file
          headers:
            Content-Disposition:
              description: Attachment header to prompt file download
              schema:
                type: string
          content:
            text/csv:
              schema:
                type: string
                format: binary
components:
  schemas:
    Student:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
          format: email
        first_name:
          type: string
        last_name:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      description: A student resource
    inline_response_200:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/Student"
        page:
          type: integer
        page_size:
          type: integer
        total:
          type: integer
        total_pages:
          type: integer
    students_upload_body:
      required:
      - file
      type: object
      properties:
        file:
          type: string
          description: CSV file containing student data
          format: binary
    inline_response_200_1:
      type: object
      properties:
        inserted:
          type: integer
          description: Number of rows inserted
        updated:
          type: integer
          description: Number of rows updated
        skipped:
          type: integer
          description: Number of rows skipped
        total:
          type: integer
          description: Total rows processed
        errors:
          type: array
          items:
            $ref: "#/components/schemas/inline_response_200_1_errors"
    inline_response_400:
      type: object
      properties:
        error:
          type: string
    inline_response_200_1_errors:
      type: object
      properties:
        line:
          type: integer
          description: Line number with error
        message:
          type: string
          description: Description of the validation error
